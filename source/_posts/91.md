---
title: 从91Pxxn中学cookie
tags:
  - cookie
  - js
categories:
  - 学习笔记
date: 2017-03-13 13:22:59
---


## 前言

在91Pxxn中，非vip用户只能观看10个视频，很不舒服。我猜这功能要么是由服务器控制，要么是由浏览器storage实现，如果是服务器来实现，那么就没办法了。f12打开谷歌devtool-application，看了下cookie，发现有watch_times这个cookie，删除后发现又可以观看了....以前只知道cookie和session，趁此学习一下客户端的存储。

<!-- more -->

## cookie

因为HTTP的无状态，使得服务器无法知道客户端上一次的操作，于是cookie这中机制便被创造出来了。

HTTP cookie，用于存储会话信息，客户端向服务器发送请求，服务器对发过来的请求发送包含会话信息的Set-Cookie HTTP头。

格式如下：
```
HTTP/1.1  200  OK
Content-type: text/html
Set-Cookie: name=value
```
name为cookie名，value为对应的值，浏览器讲这个cookie存储在浏览器中，这样即使浏览器被关闭后，重新打开访问该网站，会将此cookie包含再请求中发送给服务器，服务器就能获取之前的信息。
```
GET /index.html HTTP/1.1
Content-Type: text/html
Cookie: name=value
```
cookie中主要有以下几块信息：
- 名称(name):唯一确定cookie的名称，不区分大小写，通过URL编码
- 值(value):存储在cookie中的字符串，通过URL编码
- 域(domain):cookie对于哪一个域名有效，发送给这个域名的请求会包含这个cookie信息
- 路径(path):对于域中的哪个路径发送的请求会包含这个cookie
- 失效时间(expries/max-age):cookie有效的时间，或何时会被浏览器删除
- 安全(security):指定后cookie只能在使用SSL连接的时候才会被发送到服务器

console中，document.cookie会返回当前页面中可用的cookie，返回的是字符串的格式"name1=value1;name2=value2"

若要设置cookie，可以使用document.cookie = 'name=value'，当name与原存在的cookie冲突时，会覆盖原cookie，因为URL编码的原因，若非使用ASCII字符而使用中文等，必须使用encodeURIComponent()来URL编码。

ps：escape也可以
[简单明了区分escape、encodeURI和encodeURIComponent](http://www.cnblogs.com/season-huang/p/3439277.html)

cookie缺陷：
- 客户端对cookie的大小数量有限制
- cookie会增加网站流量开销，减慢服务器响应速度
- cookie可以被篡改，不安全

## session

session是基于cookie的一种技术，简单来说就是服务器在cookie中设定一个数据结构如sessionID，然后根据请求中的这个sessionID从服务器存储session的数据库中获取更多的信息，这样就能使数据更加的安全也增加了操作性

## WebStorage

H5中加入了localStorage和sessionStorage，分别对应了cookie和session，可以说是升级版。

localStorage是永久化的本地存储，除非主动删除数据，否则永不过期，可以跨域。
sessionStorage则是在会话结束后会自动销毁。

两者都有自带的方法，便利了开发者。

```
setItem(key, value) 保存数据
getItem(key) 读取数据
removeItem(key) 删除某数据
clear() 删除所有数据
key(index) 得到某个索引的key
```